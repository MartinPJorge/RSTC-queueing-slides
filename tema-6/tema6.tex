\documentclass[xcolor={x11names}]{beamer}
\usetheme{Madrid}

\usepackage{amssymb}
\usepackage{ulem}
\usepackage[utf8]{inputenc}
\usepackage{mathtools}
\usepackage{multicol}
%\usepackage[x11names]{xcolor}
\usefonttheme{professionalfonts}


% Subfigures
\usepackage{caption}
\usepackage{subcaption}


% License
\usepackage[
    type={CC},
    modifier={by-nc-sa},
    version={4.0},
    imagewidth=4pt
]{doclicense}




% Change base colour beamer@blendedblue (originally RGB: 0.2,0.2,0.7)
\colorlet{beamer@blendedblue}{DarkSeaGreen4}







%% MATH commands
\DeclareMathOperator{\Var}{Var}


%% THEOREMS
%\newtheorem{theorem}{Theorem}
\newtheorem{thm}{Teorema}[section] % the main one
% Definición
%\theoremstyle{definition}
\newtheorem{definicion}{Definición}[section]
\newtheorem{lema}{Lema}[section]



%% PFGplots %%
\usepackage{pgfplots}

%% Exponential distribution
\pgfmathdeclarefunction{exponential}{1}{%
  \pgfmathparse{(#1)*exp(-#1*x)}%
}
\pgfmathdeclarefunction{exponentialcdf}{1}{%
  \pgfmathparse{1-exp(-#1*x)}%
}

%% Poisson distribution
\pgfmathdeclarefunction{poiss}{1}{%
  \pgfmathparse{(#1^x)*exp(-#1)/(x!)}%
}

%% Normal distribution (#1=mu, #2=sigma)
% John D. Cook approx. https://tex.stackexchange.com/a/124629
\pgfmathdeclarefunction{normalcdf}{2}{%
  \pgfmathparse{1/(1 + exp(-0.07056*((x-#1)/#2)^3 - 1.5976*(x-#1)/#2))}%
}




\newcommand{\red}[1]{{\color{red}#1}}
\newcommand{\blue}[1]{{\color{blue}#1}}

%%%%%%%%%%
%% TIKZ %%
%%%%%%%%%%
\usepackage{tikz}
\usepackage{animate}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes,arrows, positioning, calc}
\usetikzlibrary{overlay-beamer-styles}
\usetikzlibrary{chains,shapes.multipart}
\usetikzlibrary{scopes}
\usetikzlibrary{automata}
\usetikzlibrary{positioning}  %                 ...positioning nodes
\usetikzlibrary{arrows}       %                 ...customizing arrows
\usetikzlibrary{intersections}


%%%%%%%%%
%% PGF %%
%%%%%%%%%
\usepgfplotslibrary{fillbetween}


%%% Insert section name before the section %%%
\AtBeginSection[]{
  \begin{frame}
  \vfill
  \centering
  \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{title}
    \usebeamerfont{title}\insertsectionhead\par%
  \end{beamercolorbox}
  \vfill
  \end{frame}
}



\title[Tema 6]{Tema 6: Teletráfico en redes de datos}
%% \subtitle{Redes y Servicios de Telecomunicaciones (RSTC)\\
%% Grado en Ingeniería de Tecnologías y Servicios de Telecomunicación}
%\author{M. Saiful Bari\inst{1} \and Mr X\inst{2}}

\titlegraphic{%
\includegraphics[height=2.5cm]{../tema-5/figs/RSTC-grande.png}\\%
\doclicenseIcon {\tiny \hspace{1em}\doclicenseText}\\%
\href{https://github.com/MartinPJorge/RSTC-queueing-slides}{\includegraphics[height=1cm]{../tema-5/figs/github-logo.png}}%
}


\author{\textcolor{white}{RSTC curso 2022-2023}}
%\author{Jorge Martín Pérez\inst{1}}
%\institute{
%    \inst{1}
%    Departamento de Ingeniería Telemática, Universidad Politécnica de Madrid
%}

\date{\today}







%%%%%%%%%%%%%%%%%%%%
%%% SLIDES START %%%
%%%%%%%%%%%%%%%%%%%%
\begin{document}


%%% TITLE %%%
\frame{\titlepage}


\begin{frame}{Contenido}
    \tableofcontents
\end{frame}




\section{Introducción}
\begin{frame}{\secname}
    Hemos visto colas M/M/1
    \begin{figure}
        \input{../tema-5/figs/mm1.tex}
    \end{figure}
    con tiempos:
    \begin{itemize}
        \item de llegada exponenciales
            $t_l\sim Exp(\lambda)$
        \item de servicio exponenciales
            $t_s\sim Exp(\mu)$
    \end{itemize}

    \pause
    \vfill

    {\color{blue}
    Pero, ¿y si el tiempo de servicio $t_s$
    sigue otra distribución?
    }
     
    \pause
    \begin{itemize}
        {\color{red}
        \item sistema M/G/1
        }
    \end{itemize}
\end{frame}



\begin{frame}{\secname}
    Hemos estudiado una sola cola
    \begin{figure}
        \input{../tema-5/figs/mm1.tex}
    \end{figure}

    \vfill
    {\color{blue}
    Pero, ¿y si hay más colas?
    }
    \pause
    \begin{itemize}
        {\color{red}
        \item redes de Jackson
        }
    \end{itemize}
    \begin{figure}
        \input{figs/mm1-tandem.tex}
    \end{figure}
\end{frame}


\begin{frame}{Contenido}
    \tableofcontents
\end{frame}


\section{Sistema M/G/1}
\subsection{No Markoviano}
\begin{frame}{\secname: \subsecname}
    Tiempo de servicio sigue una distribución
    general\footnote{Por ejemplo,
    $G(\mu)=U(\tfrac{1}{2\mu}, \tfrac{2}{3\mu})$}
    $t_s\sim G(\mu)$.

    \begin{figure}
        \input{../tema-5/figs/mm1.tex}
    \end{figure}

    \vfill
    Para modelar como cadena de Markov
    es necesario que
    \begin{itemize}
        \item tiempo estancia en estado
            $t_i\sim Exp(\nu_i)$.
    \end{itemize}
\end{frame}



\begin{frame}{\secname: \subsecname}
    \begin{figure}
        \input{figs/residence-time.tex}
    \end{figure}

    \vfill
    Veamos si se cumple que $t_i\sim Exp(\nu_i)$:
    \begin{multline}
        \mathbb{P}(t_i>\tau) =
        \mathbb{P}(\min\{t_l,t_s\}>\tau)=
        \mathbb{P}(t_l>\tau)
        \mathbb{P}(t_s>\tau)\\
        =
        \left(1 - \frac{\tau}{\mu} \right)
        e^{-\mu\tau} \neq e^{-\nu_i \tau}
    \end{multline}
    con $t_s\sim G(\mu)=U\left(\tfrac{1}{2\mu},
    \tfrac{2}{3\mu}\right),\
    \tau\in\left[\tfrac{1}{2\mu},
    \tfrac{2}{3\mu}\right]$.
\end{frame}




\subsection{Tiempo medio de espera en cola}
\begin{frame}{\secname: \subsecname}
    Podemos obtener el tiempo medio
    de espera en cola $\mathbb{E}[W(t)]$ de
    un M/G/1.
    \begin{figure}
        \input{../tema-5/figs/mm1.tex}
    \end{figure}
    Veamos lo que espera un usuario
    \emph{nuevo}:
    \begin{enumerate}
        \item $\mathbb{E}[Q(t)]\tfrac{1}{\mu}$
            en cola ; y
        \item la media del tiempo residual
            $R$ del que
            se está sirviendo.
    \end{enumerate}
    \begin{align*}
        \mathbb{E}[W(t)]&=
        \mathbb{E}[Q(t)]\tfrac{1}{\mu}
        + \mathbb{E}[R(t)]\\
        &\implies \mathbb{E}[(W(t))]=
        \frac{\mathbb{E}[R(t)]}{1-\rho}
    \end{align*}
\end{frame}




\begin{frame}{\secname: \subsecname}
    Interpretación gráfica de tiempo
    residual en cada instante $R(t)$:
    \begin{figure}
        \input{figs/residual-easy.tex}
    \end{figure}
\end{frame}



\begin{frame}{\secname: \subsecname}
    \footnote{
    Ilustración y demostración basadas
    en~\cite[Figura 8.3]{amable}.}
    La media del tiempo residual corresponde
    con el promedio de áreas.
    \begin{figure}
        \input{figs/residual.tex}
    \end{figure}
    \begin{align*}
        \mathbb{E}[R(t)]=&\lim_{t\to\infty}
        \int_0^t
        R(\tau)\ d\tau\\
        =& \lim_{t\to\infty} \frac{1}{t}
        \sum_{i=1}^{N(t)} \frac{t_{s,i}^2}{2}
    \end{align*}
\end{frame}




\begin{frame}{\secname: \subsecname}
    Multiplicando y dividiendo por
    $N(t)$:
    \begin{align*}
        \mathbb{E}[R(t)]
        =& \lim_{t\to\infty}\frac{1}{t}
        \sum_{i=1}^{N(t)} \frac{t_{s,i}^2}{2}\\
        =& \frac{1}{2}
        \left( \lim_{t\to\infty} \frac{N(t)}{t}
        \right)
        \left( \lim_{t\to\infty} \frac{1}{N(t)}
        \sum_{i=1}^{N(t)} t_{s,i}^2
        \right)\\
        =& \frac{1}{2} \cdot \lambda\cdot
        \mathbb{E}[t_s^2]
    \end{align*}
    con $t_{s,i}$ la realización
    de la v.a. del tiempo de servicio
    para el usuario $i$.
\end{frame}



\begin{frame}{\secname: \subsecname}
    \begin{lema}[Fórmula de Pollaczek-Khintchine]
        El tiempo medio de espera en cola
        de en un sistema M/G/1 es
        \begin{equation}
            \mathbb{E}[W(t)]=
            \frac{\lambda\mathbb{E}[t_s^2]}{2(1-\rho)}
        \end{equation}
        con $t_s$ la v.a. del tiempo de
        servicio que sigue una distribución
        $G$.
    \end{lema}
    \textit{Demostración}:
    \begin{equation*}
        \mathbb{E}[W(t)]
        =\frac{\mathbb{E}[R(t)]}{1-\rho}
        =\frac{\tfrac{1}{2}\lambda\mathbb{E}[t_s^2]}{1-\rho}
        =\frac{\lambda\mathbb{E}[t_s^2]}{2(1-\rho)}
    \end{equation*}

\end{frame}




\subsection{Ejemplos distribuciones servicio}
\begin{frame}{\secname: \subsecname}
    \textit{Ejemplo}: supongamos un tiempo
    de servicio $t_s\sim Exp(\mu)$.
    \begin{align*}
        \mathbb{E}[t_s^2]
        =& \int_0^\infty
        \tau^2 \mu e^{-\mu\tau}
        \ d\tau\\
        \underbrace{=}_{partes}&
        \left[-\tau^2e^{-\mu\tau} \right]_{\tau=0}^\infty
        -\int_0^\infty -e^{-\mu\tau}2\tau\ 
        d\tau\\
        =&\int_0^\infty
        2\tau e^{-\mu\tau}\ d\tau\\
        \underbrace{=}_{partes}&
        \frac{2}{\mu^2}
    \end{align*}
    Usando Pollaczek-Khintchine tenemos
    \begin{equation*}
        \mathbb{E}[W(t)]=
        \frac{\lambda\mathbb{E}[t_s^2]}{2(1-\rho)}
        =\frac{\rho}{\mu(1-\rho)}
    \end{equation*}
    la expresión que vimos para M/M/1.
\end{frame}






\begin{frame}{\secname: \subsecname}
    \textit{Ejemplo}: supongamos un tiempo
    de servicio $t_s\sim U(0,\frac{2}{\mu})$.
    \begin{align*}
        \mathbb{E}[t_s^2]
        =& \int_0^{\tfrac{2}{\mu}}
        \tau^2 \frac{1}{2/\mu}
        \ d\tau\\
        =& \frac{\mu}{2}\left[
            \frac{\tau^3}{3}
        \right]_{\tau=0}^{\tfrac{2}{\mu}}\\
        =& \frac{4}{3\mu^2}
    \end{align*}
    Usando Pollaczek-Khintchine tenemos
    \begin{equation*}
        \mathbb{E}[W(t)]=
        \frac{\lambda\mathbb{E}[t_s^2]}{2(1-\rho)}
        =\frac{2}{3}\frac{\rho}{\mu(1-\rho)}
    \end{equation*}
\end{frame}



\begin{frame}{\secname: \subsecname}
    Otra manera de ver el momento de
    segundo orden es sabiendo que
    \begin{equation*}
        \mathbb{E}[t_s^2]=\Var[t_s]+
        \mathbb{E}^2[t_s]
    \end{equation*}
    \vfill
    \textit{Ejemplo}:
    \begin{itemize}
        \item $t_s\sim Exp(\mu)\implies
            \mathbb{E}[t_s^2]=\frac{1}{\mu^2}+
            \frac{1}{\mu^2}$;
        \item $t_s\sim U\left(0,\tfrac{2}{\mu}
            \right)
            \implies
            \mathbb{E}[t_s^2]=\frac{1}{12}
            \left(\frac{2}{\mu}-0\right)^2+
            \frac{1}{\mu^2}
            =\frac{4}{3\mu^2}$.
    \end{itemize}
    que coincide con las expresiones anteriores.
\end{frame}


\subsection{M/M/1 como caso peor}
\begin{frame}{\secname: \subsecname}
    El tiempo medio de servicio
    $\mathbb{E}[T(t)]$
    es pesimista en un M/M/1.

    \vfill


    \begin{figure}
        \input{figs/pesimistic.tex}
    \end{figure}
    \textit{Ejemplo (arriba)}: el tiempo medio
    total es menor\footnote{
        Tomamos $\mu=1$
    [usuario/sec].} en una
    uniforme.


    % \begin{align*}
    %     \mathbb{E}[W_U(t)]+\tfrac{1}{\mu}<&
    %     \mathbb{E}[W_{Exp}(t)]+\tfrac{1}\mu\\
    %     \frac{2}{3}\frac{\rho}{\mu(1-\rho)}<&
    %     \frac{\rho}{\mu(1-\rho)}\\
    %     \frac{2}{3}<&1
    % \end{align*}
    % vemos que es
\end{frame}






%   Sabiendo que:
%   \begin{itemize}
%       \item hay $Q(t)$ usuarios en
%           cola; y
%       \item tiempo medio de servicio
%           $\mathbb{E}[t_s]=\tfrac{1}{\mu}$
%   \end{itemize}

%   Un usuario nuevo tarda en ser servido
%   $Q(t)\cdot \tfrac{1}{\mu} + 







\section{Redes de Jackson}




\begin{frame}[allowframebreaks]
        \frametitle{Referencias}
        \bibliographystyle{amsalpha}
        \bibliography{refs.bib}
\end{frame}


\end{document}
